<%- include('../admin/layouts/header.ejs') %>
<%- include('../admin/layouts/sidebar.ejs') %>
<%- include('../admin/layouts/navbar.ejs') %>

<!-- Content for viewing products -->
<div class="main-panel">
  <div class="content-wrapper">

    <div class="category-filter">
      <label for="categoryFilter">Filter by Category:</label>
      <select id="categoryFilter" name="categoryFilter">
        <option value="">All Categories</option>
        <% category.forEach(category => { %>
          <option value="<%= category.categoryName %>"><%= category.categoryName %></option>
        <% }); %>
      </select>
    </div>

    <div class="col-12 grid-margin stretch-card">
      <div class="card">
        <div class="card-body">
          <h2 class="card-title">PRODUCTS</h2>

          <!-- Display the list of products -->
          <table class="table">
            <thead>
              <tr>
                <th>Product Name</th>
                <th>Category</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Description</th>
                <th>Image</th>
                <th>Size</th>
                <th> Edit </th>
                <th> Action </th>
              </tr>
            </thead>
            <tbody>
              <% data.forEach(data => { %>
                <tr>
                  <td><%= data.productName %></td>
                  <td><%= data.category.categoryName %></td>
                  <td><%= data.price %></td>
                  <td><%= data.quantity %></td>
                  <td><%= data.description %></td>
                  <td><img src="/public/adminAssets/assets/images/products/<%= data.image %>" alt="<%= data.productName %>"></td>
                  <td><%= data.size %></td>
                  <td> <a href="/admin/edit_product?id=<%= data._id%>">
                    <button type="button" class="btn btn-outline-secondary btn-icon-text">
                      Edit <i class="mdi mdi-file-check btn-icon-append"></i>
                    </button>
                  </a></td>
                  <td><% if (data.status === false) { %>
                    <a href="/admin/unlist_product?id=<%= data._id %>">
                      <button type="button" class="btn btn-inverse-success btn-fw">
                        List
                      </button>
                    </a>
                  <% } else { %>
                    <a href="/admin/unlist_product?id=<%= data._id %>">
                      <button type="button" class="btn btn-inverse-danger btn-fw">
                        Unlist
                      </button>
                    </a> 
                  <% } %></td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    $('#categoryFilter').change(function () {
      var selectedCategory = $(this).val();
      var products = $('.table tbody tr');
      if (selectedCategory === '') {
        products.show();
      } else {
        products.hide();
        products.each(function () {
          var category = $(this).find('td:eq(1)').text();
          if (category === selectedCategory) {
            $(this).show();
          }
        });
      }
    });
  });
</script>

<%- include('../admin/layouts/footer.ejs') %>
